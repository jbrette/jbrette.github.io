<!DOCTYPE HTML>

<html>
    <head>
        <script type="application/ld+json">
    {
        "@context" : "http://schema.org",
        "@type" : "BlogPosting",
        "mainEntityOfPage": {
             "@type": "WebPage",
             "@id": "https:\/\/jbrette.github.io\/"
        },
        "articleSection" : "kubedge",
        "name" : "Upgrade RPI Kubernetes cluster to 1.12",
        "headline" : "Upgrade RPI Kubernetes cluster to 1.12",
        "description" : "Goal The new Kubernetes 1.12 is out. THe goal is to update my two clusters to 1.12 using kubeadm 1.12\nMaster node upgrade using kubeadm # apt-mark unhold kubeadm \u0026amp;\u0026amp; \\ \u0026gt; apt-get update \u0026amp;\u0026amp; apt-get install -y kubeadm \u0026amp;\u0026amp; \\ \u0026gt; apt-mark hold kubeadm kubeadm was already not hold. Hit:2 http:\/\/raspbian.raspberrypi.org\/raspbian stretch InRelease Hit:3 https:\/\/download.docker.com\/linux\/raspbian stretch InRelease Hit:1 https:\/\/packages.cloud.google.com\/apt kubernetes-xenial InRelease Hit:5 http:\/\/archive.raspberrypi.org\/debian stretch InRelease Hit:4 https:\/\/packagecloud.io\/Hypriot\/rpi\/debian stretch InRelease Reading package lists.",
        "inLanguage" : "en",
        "author" : "",
        "creator" : "",
        "publisher": "",
        "accountablePerson" : "",
        "copyrightHolder" : "",
        "copyrightYear" : "2018",
        "datePublished": "2018-09-29 00:00:00 \u002b0000 UTC",
        "dateModified" : "2018-09-29 00:00:00 \u002b0000 UTC",
        "url" : "https:\/\/jbrette.github.io\/kubedge\/2018-09-28-a\/",
        "wordCount" : "2039",
        "keywords" : [ "kubedge","kubernetes","rpi","Blog" ]
    }
    </script>
        
            
                <title>Upgrade RPI Kubernetes cluster to 1.12</title>
            
        

        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="generator" content="Hugo 0.92.2" />
        


        
            <meta name="author" content="Jerome Brette">
        
        
            
                <meta name="description" content="Jerome Brette&#39;s Blog">
            
        

        <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Upgrade RPI Kubernetes cluster to 1.12"/>
<meta name="twitter:description" content="Goal The new Kubernetes 1.12 is out. THe goal is to update my two clusters to 1.12 using kubeadm 1.12
Master node upgrade using kubeadm # apt-mark unhold kubeadm &amp;&amp; \ &gt; apt-get update &amp;&amp; apt-get install -y kubeadm &amp;&amp; \ &gt; apt-mark hold kubeadm kubeadm was already not hold. Hit:2 http://raspbian.raspberrypi.org/raspbian stretch InRelease Hit:3 https://download.docker.com/linux/raspbian stretch InRelease Hit:1 https://packages.cloud.google.com/apt kubernetes-xenial InRelease Hit:5 http://archive.raspberrypi.org/debian stretch InRelease Hit:4 https://packagecloud.io/Hypriot/rpi/debian stretch InRelease Reading package lists."/>
<meta name="twitter:site" content="@example"/>

        <meta property="og:title" content="Upgrade RPI Kubernetes cluster to 1.12" />
<meta property="og:description" content="Goal The new Kubernetes 1.12 is out. THe goal is to update my two clusters to 1.12 using kubeadm 1.12
Master node upgrade using kubeadm # apt-mark unhold kubeadm &amp;&amp; \ &gt; apt-get update &amp;&amp; apt-get install -y kubeadm &amp;&amp; \ &gt; apt-mark hold kubeadm kubeadm was already not hold. Hit:2 http://raspbian.raspberrypi.org/raspbian stretch InRelease Hit:3 https://download.docker.com/linux/raspbian stretch InRelease Hit:1 https://packages.cloud.google.com/apt kubernetes-xenial InRelease Hit:5 http://archive.raspberrypi.org/debian stretch InRelease Hit:4 https://packagecloud.io/Hypriot/rpi/debian stretch InRelease Reading package lists." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://jbrette.github.io/kubedge/2018-09-28-a/" /><meta property="article:section" content="kubedge" />
<meta property="article:published_time" content="2018-09-29T00:00:00+00:00" />
<meta property="article:modified_time" content="2018-09-29T00:00:00+00:00" />


        <meta property="og:image" content="https://jbrette.github.io//images/logo.png">
        <meta property="og:image:type" content="image/png">
        <meta property="og:image:width" content="512">
        <meta property="og:image:height" content="512">
        <meta itemprop="name" content="Upgrade RPI Kubernetes cluster to 1.12">
<meta itemprop="description" content="Goal The new Kubernetes 1.12 is out. THe goal is to update my two clusters to 1.12 using kubeadm 1.12
Master node upgrade using kubeadm # apt-mark unhold kubeadm &amp;&amp; \ &gt; apt-get update &amp;&amp; apt-get install -y kubeadm &amp;&amp; \ &gt; apt-mark hold kubeadm kubeadm was already not hold. Hit:2 http://raspbian.raspberrypi.org/raspbian stretch InRelease Hit:3 https://download.docker.com/linux/raspbian stretch InRelease Hit:1 https://packages.cloud.google.com/apt kubernetes-xenial InRelease Hit:5 http://archive.raspberrypi.org/debian stretch InRelease Hit:4 https://packagecloud.io/Hypriot/rpi/debian stretch InRelease Reading package lists."><meta itemprop="datePublished" content="2018-09-29T00:00:00+00:00" />
<meta itemprop="dateModified" content="2018-09-29T00:00:00+00:00" />
<meta itemprop="wordCount" content="2039">
<meta itemprop="keywords" content="kubedge,kubernetes,rpi," />
        

        
            
        

        
        
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css">
            <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway:400,800,900|Source+Sans+Pro:400,700">
            <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.1.25/jquery.fancybox.min.css">
            <link rel="stylesheet" href="https://jbrette.github.io/css/main.css">
            <link rel="stylesheet" href="https://jbrette.github.io/css/add-on.css">
            <link rel="stylesheet" href="https://jbrette.github.io/css/academicons.min.css">
        

        
            
                
            
        


  
    
    <link href='//cdn.bootcss.com/highlight.js/9.11.0/styles/github.min.css' rel='stylesheet' type='text/css' />
  


      
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-123357787-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
    </head>
    <body>

      
      <div id="wrapper">

    
    
<header id="header">
    
      <h1><a href="https://jbrette.github.io/">kubedge</a></h1>
    

    <nav class="links">
        <ul>
            
                <li>
                    <a href="https://jbrette.github.io/">
                            <i class="fa fa-home">&nbsp;</i>Home
                    </a>
                </li>
            
                <li>
                    <a href="https://jbrette.github.io/about/">
                            <i class="fa fa-id-card-o">&nbsp;</i>About
                    </a>
                </li>
            
                <li>
                    <a href="https://jbrette.github.io/post/">
                            <i class="fa fa-newspaper-o">&nbsp;</i>Blog
                    </a>
                </li>
            
                <li>
                    <a href="https://jbrette.github.io/kubedge/">
                            <i class="fas fa-atom">&nbsp;</i>Kubedge
                    </a>
                </li>
            
                <li>
                    <a href="https://jbrette.github.io/iot/">
                            <i class="">&nbsp;</i>IoT
                    </a>
                </li>
            
                <li>
                    <a href="https://jbrette.github.io/ai_ml/">
                            <i class="">&nbsp;</i>AI &amp; ML
                    </a>
                </li>
            
                <li>
                    <a href="https://jbrette.github.io/blockchain/">
                            <i class="">&nbsp;</i>BlockChain
                    </a>
                </li>
            
                <li>
                    <a href="https://jbrette.github.io/misc/">
                            <i class="">&nbsp;</i>Other
                    </a>
                </li>
            
                <li>
                    <a href="https://jbrette.github.io/tags/">
                            <i class="fa fa-list">&nbsp;</i>Tags
                    </a>
                </li>
            
        </ul>
    </nav>
    <nav class="main">
        <ul>
            
            <li id="share-nav" class="share-menu" style="display:none;">
                <a class="fa-share-alt" href="#share-menu">Share</a>
            </li>
            
            <li class="search">
                <a class="fa-search" href="#search">Search</a>
                <form id="search" method="get" action="//google.com/search">
                    <input type="text" name="q" placeholder="Search" />
                    <input type="hidden" name="as_sitesearch" value="https://jbrette.github.io/">
                </form>
            </li>
            <li class="menu">
                <a class="fa-bars" href="#menu">Menu</a>
            </li>
        </ul>
    </nav>
</header>


<section id="menu">

    
        <section>
            <form class="search" method="get" action="//google.com/search">
                <input type="text" name="q" placeholder="Search" />
                <input type="hidden" name="as_sitesearch" value="https://jbrette.github.io/">
            </form>
        </section>

    
        <section>
            <ul class="links">
                
                    <li>
                        <a href="https://jbrette.github.io/">
                            <h3>
                                <i class="fa fa-home">&nbsp;</i>Home
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="https://jbrette.github.io/about/">
                            <h3>
                                <i class="fa fa-id-card-o">&nbsp;</i>About
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="https://jbrette.github.io/post/">
                            <h3>
                                <i class="fa fa-newspaper-o">&nbsp;</i>Blog
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="https://jbrette.github.io/kubedge/">
                            <h3>
                                <i class="fas fa-atom">&nbsp;</i>Kubedge
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="https://jbrette.github.io/iot/">
                            <h3>
                                <i class="">&nbsp;</i>IoT
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="https://jbrette.github.io/ai_ml/">
                            <h3>
                                <i class="">&nbsp;</i>AI &amp; ML
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="https://jbrette.github.io/blockchain/">
                            <h3>
                                <i class="">&nbsp;</i>BlockChain
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="https://jbrette.github.io/misc/">
                            <h3>
                                <i class="">&nbsp;</i>Other
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="https://jbrette.github.io/tags/">
                            <h3>
                                <i class="fa fa-list">&nbsp;</i>Tags
                            </h3>
                        </a>
                    </li>
                
            </ul>
        </section>

    
        <section class="recent-posts">
            <div class="mini-posts">
                <header>
                    <h3>Recent Posts</h3>
                </header>
                

                
                    
                

                
                        <article class="mini-post">
                            <header>
                                <h3><a href="https://jbrette.github.io/post/">Post</a></h3>
                                
                                <time class="published" datetime=
                                    '2018-10-03'>
                                    October 3, 2018</time>
                            </header>
                            

                        </article>
                
                        <article class="mini-post">
                            <header>
                                <h3><a href="https://jbrette.github.io/post/2018-10-03-a/">Prometheus</a></h3>
                                
                                <time class="published" datetime=
                                    '2018-10-03'>
                                    October 3, 2018</time>
                            </header>
                            
    

    
        
        







  
  
    
  


        
        
        

        <a href="https://jbrette.github.io/post/2018-10-03-a/" class="image featured">
            <img src="https://jbrette.github.io/img/2018/10/load-node-stack1.png" alt="">
        </a>
    


                        </article>
                
                        <article class="mini-post">
                            <header>
                                <h3><a href="https://jbrette.github.io/post/2018-09-28-a/">Rolling Upgrade</a></h3>
                                
                                <time class="published" datetime=
                                    '2018-09-28'>
                                    September 28, 2018</time>
                            </header>
                            
    

    
        
        







  
  
    
  


        
        
        

        <a href="https://jbrette.github.io/post/2018-09-28-a/" class="image featured">
            <img src="https://jbrette.github.io/img/2018/09/rolling-upgrade.jpg" alt="">
        </a>
    


                        </article>
                

                
                    <a href=
                        
                            /post/
                        
                        class="button">View more posts</a>
                
            </div>
        </section>

    
        
</section>

    <section id="share-menu">
    <section id="social-share-nav">
        <ul class="links">
            <header>
                <h3>Share this post <i class="fa fa-smile-o"></i></h3>
            </header>
            



<li>
  <a href="//twitter.com/share?url=https%3a%2f%2fjbrette.github.io%2fkubedge%2f2018-09-28-a%2f&amp;text=Upgrade%20RPI%20Kubernetes%20cluster%20to%201.12&amp;via=example" target="_blank" class="share-btn twitter">
    <i class="fa fa-twitter"></i>
    <p>Twitter</p>
    </a>
</li>




<li>
  <a href="//plus.google.com/share?url=https%3a%2f%2fjbrette.github.io%2fkubedge%2f2018-09-28-a%2f" target="_blank" class="share-btn google-plus">
    <i class="fa fa-google-plus"></i>
    <p>Google+</p>
  </a>
</li>





<li>
  <a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fjbrette.github.io%2fkubedge%2f2018-09-28-a%2f" target="_blank" class="share-btn facebook">
    <i class="fa fa-facebook"></i>
    <p>Facebook</p>
    </a>
</li>




<li>
  <a href="//reddit.com/submit?url=https%3a%2f%2fjbrette.github.io%2fkubedge%2f2018-09-28-a%2f&amp;title=Upgrade%20RPI%20Kubernetes%20cluster%20to%201.12" target="_blank" class="share-btn reddit">
    <i class="fa fa-reddit-alien"></i>
    <p>Reddit</p>
  </a>
</li>




<li>
  <a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fjbrette.github.io%2fkubedge%2f2018-09-28-a%2f&amp;title=Upgrade%20RPI%20Kubernetes%20cluster%20to%201.12" target="_blank" class="share-btn linkedin">
      <i class="fa fa-linkedin"></i>
      <p>LinkedIn</p>
    </a>
</li>




<li>
  <a href="//www.stumbleupon.com/submit?url=https%3a%2f%2fjbrette.github.io%2fkubedge%2f2018-09-28-a%2f&amp;title=Upgrade%20RPI%20Kubernetes%20cluster%20to%201.12" target="_blank" class="share-btn stumbleupon">
    <i class="fa fa-stumbleupon"></i>
    <p>StumbleUpon</p>
  </a>
</li>




<li>
  <a href="//www.pinterest.com/pin/create/button/?url=https%3a%2f%2fjbrette.github.io%2fkubedge%2f2018-09-28-a%2f&amp;description=Upgrade%20RPI%20Kubernetes%20cluster%20to%201.12" target="_blank" class="share-btn pinterest">
    <i class="fa fa-pinterest-p"></i>
    <p>Pinterest</p>
  </a>
</li>




<li>
  <a href="mailto:?subject=Check out this post by Jerome%20Brette&amp;body=https%3a%2f%2fjbrette.github.io%2fkubedge%2f2018-09-28-a%2f" target="_blank" class="share-btn email">
    <i class="fa fa-envelope"></i>
    <p>Email</p>
  </a>
</li>


        </ul>
    </section>
</section>

    
    <div id="main">
        
        
        <article class="post">
  <header>
    <div class="title">
        
            <h1><a href="https://jbrette.github.io/kubedge/2018-09-28-a/">Upgrade RPI Kubernetes cluster to 1.12</a></h1>
            
        
        
    </div>
    <div class="meta">

      <span class="author">Jerome Brette</span>
      <span class="author">deprecated</span>
      
        <a href="https://kubedge.cloud/pi_cluster/" target="_blank">Moved to KUBEDGE</a>
      
    </div>
</header>


  
    <section id="social-share">
      <ul class="icons">
        



<li>
  <a href="//twitter.com/share?url=https%3a%2f%2fjbrette.github.io%2fkubedge%2f2018-09-28-a%2f&amp;text=Upgrade%20RPI%20Kubernetes%20cluster%20to%201.12&amp;via=example" target="_blank" class="share-btn twitter">
    <i class="fa fa-twitter"></i>
    <p>Twitter</p>
    </a>
</li>




<li>
  <a href="//plus.google.com/share?url=https%3a%2f%2fjbrette.github.io%2fkubedge%2f2018-09-28-a%2f" target="_blank" class="share-btn google-plus">
    <i class="fa fa-google-plus"></i>
    <p>Google+</p>
  </a>
</li>





<li>
  <a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fjbrette.github.io%2fkubedge%2f2018-09-28-a%2f" target="_blank" class="share-btn facebook">
    <i class="fa fa-facebook"></i>
    <p>Facebook</p>
    </a>
</li>




<li>
  <a href="//reddit.com/submit?url=https%3a%2f%2fjbrette.github.io%2fkubedge%2f2018-09-28-a%2f&amp;title=Upgrade%20RPI%20Kubernetes%20cluster%20to%201.12" target="_blank" class="share-btn reddit">
    <i class="fa fa-reddit-alien"></i>
    <p>Reddit</p>
  </a>
</li>




<li>
  <a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fjbrette.github.io%2fkubedge%2f2018-09-28-a%2f&amp;title=Upgrade%20RPI%20Kubernetes%20cluster%20to%201.12" target="_blank" class="share-btn linkedin">
      <i class="fa fa-linkedin"></i>
      <p>LinkedIn</p>
    </a>
</li>




<li>
  <a href="//www.stumbleupon.com/submit?url=https%3a%2f%2fjbrette.github.io%2fkubedge%2f2018-09-28-a%2f&amp;title=Upgrade%20RPI%20Kubernetes%20cluster%20to%201.12" target="_blank" class="share-btn stumbleupon">
    <i class="fa fa-stumbleupon"></i>
    <p>StumbleUpon</p>
  </a>
</li>




<li>
  <a href="//www.pinterest.com/pin/create/button/?url=https%3a%2f%2fjbrette.github.io%2fkubedge%2f2018-09-28-a%2f&amp;description=Upgrade%20RPI%20Kubernetes%20cluster%20to%201.12" target="_blank" class="share-btn pinterest">
    <i class="fa fa-pinterest-p"></i>
    <p>Pinterest</p>
  </a>
</li>




<li>
  <a href="mailto:?subject=Check out this post by Jerome%20Brette&amp;body=https%3a%2f%2fjbrette.github.io%2fkubedge%2f2018-09-28-a%2f" target="_blank" class="share-btn email">
    <i class="fa fa-envelope"></i>
    <p>Email</p>
  </a>
</li>


      </ul>
    </section>
  

  
  <div id="content">
    <h1 id="goal">Goal</h1>
<p>The new Kubernetes 1.12 is out. THe goal is to update my two clusters to 1.12
using kubeadm 1.12</p>
<h2 id="master-node-upgrade-using-kubeadm">Master node upgrade using kubeadm</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># apt-mark unhold kubeadm &amp;&amp; \</span>
&gt; apt-get update <span style="color:#f92672">&amp;&amp;</span> apt-get install -y kubeadm <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>&gt; apt-mark hold kubeadm
kubeadm was already not hold.
Hit:2 http://raspbian.raspberrypi.org/raspbian stretch InRelease
Hit:3 https://download.docker.com/linux/raspbian stretch InRelease
Hit:1 https://packages.cloud.google.com/apt kubernetes-xenial InRelease
Hit:5 http://archive.raspberrypi.org/debian stretch InRelease
Hit:4 https://packagecloud.io/Hypriot/rpi/debian stretch InRelease
Reading package lists... Done
Reading package lists... Done
Building dependency tree
Reading state information... Done
The following packages will be upgraded:
  kubeadm
<span style="color:#ae81ff">1</span> upgraded, <span style="color:#ae81ff">0</span> newly installed, <span style="color:#ae81ff">0</span> to remove and <span style="color:#ae81ff">38</span> not upgraded.
Need to get 8,095 kB of archives.
After this operation, 3,100 kB disk space will be freed.
Get:1 https://packages.cloud.google.com/apt kubernetes-xenial/main armhf kubeadm armhf 1.12.0-00 <span style="color:#f92672">[</span>8,095 kB<span style="color:#f92672">]</span>
Fetched 8,095 kB in 4s <span style="color:#f92672">(</span>1,962 kB/s<span style="color:#f92672">)</span>
<span style="color:#f92672">(</span>Reading database ... <span style="color:#ae81ff">30574</span> files and directories currently installed.<span style="color:#f92672">)</span>
Preparing to unpack .../kubeadm_1.12.0-00_armhf.deb ...
Unpacking kubeadm <span style="color:#f92672">(</span>1.12.0-00<span style="color:#f92672">)</span> over <span style="color:#f92672">(</span>1.11.1-00<span style="color:#f92672">)</span> ...
Setting up kubeadm <span style="color:#f92672">(</span>1.12.0-00<span style="color:#f92672">)</span> ...
kubeadm set on hold.
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo kubeadm upgrade plan
<span style="color:#f92672">[</span>preflight<span style="color:#f92672">]</span> Running pre-flight checks.
<span style="color:#f92672">[</span>upgrade<span style="color:#f92672">]</span> Making sure the cluster is healthy:
<span style="color:#f92672">[</span>upgrade/config<span style="color:#f92672">]</span> Making sure the configuration is correct:
<span style="color:#f92672">[</span>upgrade/config<span style="color:#f92672">]</span> Reading configuration from the cluster...
<span style="color:#f92672">[</span>upgrade/config<span style="color:#f92672">]</span> FYI: You can look at this config file with <span style="color:#e6db74">&#39;kubectl -n kube-system get cm kubeadm-config -oyaml&#39;</span>
<span style="color:#f92672">[</span>upgrade<span style="color:#f92672">]</span> Fetching available versions to upgrade to
<span style="color:#f92672">[</span>upgrade/versions<span style="color:#f92672">]</span> Cluster version: v1.11.0
<span style="color:#f92672">[</span>upgrade/versions<span style="color:#f92672">]</span> kubeadm version: v1.12.0
<span style="color:#f92672">[</span>upgrade/versions<span style="color:#f92672">]</span> Latest stable version: v1.12.0
<span style="color:#f92672">[</span>upgrade/versions<span style="color:#f92672">]</span> Latest version in the v1.11 series: v1.11.3

Components that must be upgraded manually after you have upgraded the control plane with <span style="color:#e6db74">&#39;kubeadm upgrade apply&#39;</span>:
COMPONENT   CURRENT       AVAILABLE
Kubelet     <span style="color:#ae81ff">3</span> x v1.11.1   v1.11.3

Upgrade to the latest version in the v1.11 series:

COMPONENT            CURRENT   AVAILABLE
API Server           v1.11.0   v1.11.3
Controller Manager   v1.11.0   v1.11.3
Scheduler            v1.11.0   v1.11.3
Kube Proxy           v1.11.0   v1.11.3
CoreDNS              1.1.3     1.2.2
Etcd                 3.2.18    3.2.18

You can now apply the upgrade by executing the following command:

        kubeadm upgrade apply v1.11.3

_____________________________________________________________________

Components that must be upgraded manually after you have upgraded the control plane with <span style="color:#e6db74">&#39;kubeadm upgrade apply&#39;</span>:
COMPONENT   CURRENT       AVAILABLE
Kubelet     <span style="color:#ae81ff">3</span> x v1.11.1   v1.12.0

Upgrade to the latest stable version:

COMPONENT            CURRENT   AVAILABLE
API Server           v1.11.0   v1.12.0
Controller Manager   v1.11.0   v1.12.0
Scheduler            v1.11.0   v1.12.0
Kube Proxy           v1.11.0   v1.12.0
CoreDNS              1.1.3     1.2.2
Etcd                 3.2.18    3.2.24

You can now apply the upgrade by executing the following command:

        kubeadm upgrade apply v1.12.0

_____________________________________________________________________
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ sudo kubeadm upgrade apply v1.12.0
<span style="color:#f92672">[</span>preflight<span style="color:#f92672">]</span> Running pre-flight checks.
<span style="color:#f92672">[</span>upgrade<span style="color:#f92672">]</span> Making sure the cluster is healthy:
<span style="color:#f92672">[</span>upgrade/config<span style="color:#f92672">]</span> Making sure the configuration is correct:
<span style="color:#f92672">[</span>upgrade/config<span style="color:#f92672">]</span> Reading configuration from the cluster...
<span style="color:#f92672">[</span>upgrade/config<span style="color:#f92672">]</span> FYI: You can look at this config file with <span style="color:#e6db74">&#39;kubectl -n kube-system get cm kubeadm-config -oyaml&#39;</span>
<span style="color:#f92672">[</span>upgrade/apply<span style="color:#f92672">]</span> Respecting the --cri-socket flag that is set with higher priority than the config file.
<span style="color:#f92672">[</span>upgrade/version<span style="color:#f92672">]</span> You have chosen to change the cluster version to <span style="color:#e6db74">&#34;v1.12.0&#34;</span>
<span style="color:#f92672">[</span>upgrade/versions<span style="color:#f92672">]</span> Cluster version: v1.11.0
<span style="color:#f92672">[</span>upgrade/versions<span style="color:#f92672">]</span> kubeadm version: v1.12.0
<span style="color:#f92672">[</span>upgrade/confirm<span style="color:#f92672">]</span> Are you sure you want to proceed with the upgrade? <span style="color:#f92672">[</span>y/N<span style="color:#f92672">]</span>: y
<span style="color:#f92672">[</span>upgrade/prepull<span style="color:#f92672">]</span> Will prepull images <span style="color:#66d9ef">for</span> components <span style="color:#f92672">[</span>kube-apiserver kube-controller-manager kube-scheduler etcd<span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>upgrade/prepull<span style="color:#f92672">]</span> Prepulling image <span style="color:#66d9ef">for</span> component kube-apiserver.
<span style="color:#f92672">[</span>upgrade/prepull<span style="color:#f92672">]</span> Prepulling image <span style="color:#66d9ef">for</span> component kube-controller-manager.
<span style="color:#f92672">[</span>upgrade/prepull<span style="color:#f92672">]</span> Prepulling image <span style="color:#66d9ef">for</span> component kube-scheduler.
<span style="color:#f92672">[</span>upgrade/prepull<span style="color:#f92672">]</span> Prepulling image <span style="color:#66d9ef">for</span> component etcd.
<span style="color:#f92672">[</span>apiclient<span style="color:#f92672">]</span> Found <span style="color:#ae81ff">0</span> Pods <span style="color:#66d9ef">for</span> label selector k8s-app<span style="color:#f92672">=</span>upgrade-prepull-kube-apiserver
<span style="color:#f92672">[</span>apiclient<span style="color:#f92672">]</span> Found <span style="color:#ae81ff">0</span> Pods <span style="color:#66d9ef">for</span> label selector k8s-app<span style="color:#f92672">=</span>upgrade-prepull-etcd
<span style="color:#f92672">[</span>apiclient<span style="color:#f92672">]</span> Found <span style="color:#ae81ff">0</span> Pods <span style="color:#66d9ef">for</span> label selector k8s-app<span style="color:#f92672">=</span>upgrade-prepull-kube-controller-manager
<span style="color:#f92672">[</span>apiclient<span style="color:#f92672">]</span> Found <span style="color:#ae81ff">0</span> Pods <span style="color:#66d9ef">for</span> label selector k8s-app<span style="color:#f92672">=</span>upgrade-prepull-kube-scheduler
<span style="color:#f92672">[</span>apiclient<span style="color:#f92672">]</span> Found <span style="color:#ae81ff">1</span> Pods <span style="color:#66d9ef">for</span> label selector k8s-app<span style="color:#f92672">=</span>upgrade-prepull-kube-scheduler
<span style="color:#f92672">[</span>apiclient<span style="color:#f92672">]</span> Found <span style="color:#ae81ff">1</span> Pods <span style="color:#66d9ef">for</span> label selector k8s-app<span style="color:#f92672">=</span>upgrade-prepull-kube-apiserver
<span style="color:#f92672">[</span>apiclient<span style="color:#f92672">]</span> Found <span style="color:#ae81ff">1</span> Pods <span style="color:#66d9ef">for</span> label selector k8s-app<span style="color:#f92672">=</span>upgrade-prepull-kube-controller-manager
<span style="color:#f92672">[</span>apiclient<span style="color:#f92672">]</span> Found <span style="color:#ae81ff">1</span> Pods <span style="color:#66d9ef">for</span> label selector k8s-app<span style="color:#f92672">=</span>upgrade-prepull-etcd
<span style="color:#f92672">[</span>upgrade/prepull<span style="color:#f92672">]</span> Prepulled image <span style="color:#66d9ef">for</span> component etcd.
<span style="color:#f92672">[</span>upgrade/prepull<span style="color:#f92672">]</span> Prepulled image <span style="color:#66d9ef">for</span> component kube-apiserver.
<span style="color:#f92672">[</span>upgrade/prepull<span style="color:#f92672">]</span> Prepulled image <span style="color:#66d9ef">for</span> component kube-controller-manager.
<span style="color:#f92672">[</span>upgrade/prepull<span style="color:#f92672">]</span> Prepulled image <span style="color:#66d9ef">for</span> component kube-scheduler.
<span style="color:#f92672">[</span>upgrade/prepull<span style="color:#f92672">]</span> Successfully prepulled the images <span style="color:#66d9ef">for</span> all the control plane components
<span style="color:#f92672">[</span>upgrade/apply<span style="color:#f92672">]</span> Upgrading your Static Pod-hosted control plane to version <span style="color:#e6db74">&#34;v1.12.0&#34;</span>...
Static pod: kube-apiserver-master-pi hash: c30b2fa49c49e091538b2ce8e4dae186
Static pod: kube-controller-manager-master-pi hash: 22f67939f8b1abea8ba99666b78b5c93
Static pod: kube-scheduler-master-pi hash: 0e545194d6b033abd681f02dfd11f4c8
Static pod: etcd-master-pi hash: 00575b778fb80d4e48241f80ceb2ac0f
<span style="color:#f92672">[</span>etcd<span style="color:#f92672">]</span> Wrote Static Pod manifest <span style="color:#66d9ef">for</span> a local etcd instance to <span style="color:#e6db74">&#34;/etc/kubernetes/tmp/kubeadm-upgraded-manifests040184315/etcd.yaml&#34;</span>
<span style="color:#f92672">[</span>upgrade/staticpods<span style="color:#f92672">]</span> Moved new manifest to <span style="color:#e6db74">&#34;/etc/kubernetes/manifests/etcd.yaml&#34;</span> and backed up old manifest to <span style="color:#e6db74">&#34;/etc/kubernetes/tmp/kubeadm-backup-manifests-2018-09-30-00-46-56/etcd.yaml&#34;</span>
<span style="color:#f92672">[</span>upgrade/staticpods<span style="color:#f92672">]</span> Waiting <span style="color:#66d9ef">for</span> the kubelet to restart the component
<span style="color:#f92672">[</span>upgrade/staticpods<span style="color:#f92672">]</span> This might take a minute or longer depending on the component/version gap <span style="color:#f92672">(</span>timeout 5m0s
Static pod: etcd-master-pi hash: 00575b778fb80d4e48241f80ceb2ac0f
Static pod: etcd-master-pi hash: 00575b778fb80d4e48241f80ceb2ac0f
Static pod: etcd-master-pi hash: 00575b778fb80d4e48241f80ceb2ac0f
Static pod: etcd-master-pi hash: 77c6076a4d6ee044b744b041125cf918
<span style="color:#f92672">[</span>apiclient<span style="color:#f92672">]</span> Found <span style="color:#ae81ff">1</span> Pods <span style="color:#66d9ef">for</span> label selector component<span style="color:#f92672">=</span>etcd
<span style="color:#f92672">[</span>upgrade/staticpods<span style="color:#f92672">]</span> Component <span style="color:#e6db74">&#34;etcd&#34;</span> upgraded successfully!
<span style="color:#f92672">[</span>upgrade/etcd<span style="color:#f92672">]</span> Waiting <span style="color:#66d9ef">for</span> etcd to become available
<span style="color:#f92672">[</span>util/etcd<span style="color:#f92672">]</span> Waiting 0s <span style="color:#66d9ef">for</span> initial delay
<span style="color:#f92672">[</span>util/etcd<span style="color:#f92672">]</span> Attempting to see <span style="color:#66d9ef">if</span> all cluster endpoints are available 1/10
<span style="color:#f92672">[</span>upgrade/staticpods<span style="color:#f92672">]</span> Writing new Static Pod manifests to <span style="color:#e6db74">&#34;/etc/kubernetes/tmp/kubeadm-upgraded-manifests040184315&#34;</span>
<span style="color:#f92672">[</span>controlplane<span style="color:#f92672">]</span> wrote Static Pod manifest <span style="color:#66d9ef">for</span> component kube-apiserver to <span style="color:#e6db74">&#34;/etc/kubernetes/tmp/kubeadm-upgraded-manifests040184315/kube-apiserver.yaml&#34;</span>
<span style="color:#f92672">[</span>controlplane<span style="color:#f92672">]</span> wrote Static Pod manifest <span style="color:#66d9ef">for</span> component kube-controller-manager to <span style="color:#e6db74">&#34;/etc/kubernetes/tmp/kubeadm-upgraded-manifests040184315/kube-controller-manager.yaml&#34;</span>
<span style="color:#f92672">[</span>controlplane<span style="color:#f92672">]</span> wrote Static Pod manifest <span style="color:#66d9ef">for</span> component kube-scheduler to <span style="color:#e6db74">&#34;/etc/kubernetes/tmp/kubeadm-upgraded-manifests040184315/kube-scheduler.yaml&#34;</span>
<span style="color:#f92672">[</span>upgrade/staticpods<span style="color:#f92672">]</span> Moved new manifest to <span style="color:#e6db74">&#34;/etc/kubernetes/manifests/kube-apiserver.yaml&#34;</span> and backed up old manifest to <span style="color:#e6db74">&#34;/etc/kubernetes/tmp/kubeadm-backup-manifests-2018-09-30-00-46-56/kube-apiserver.yaml&#34;</span>
<span style="color:#f92672">[</span>upgrade/staticpods<span style="color:#f92672">]</span> Waiting <span style="color:#66d9ef">for</span> the kubelet to restart the component
<span style="color:#f92672">[</span>upgrade/staticpods<span style="color:#f92672">]</span> This might take a minute or longer depending on the component/version gap <span style="color:#f92672">(</span>timeout 5m0s
Static pod: kube-apiserver-master-pi hash: c30b2fa49c49e091538b2ce8e4dae186
Static pod: kube-apiserver-master-pi hash: a92106d6db4c8b5835a47f5f56c33fdb
<span style="color:#f92672">[</span>apiclient<span style="color:#f92672">]</span> Found <span style="color:#ae81ff">1</span> Pods <span style="color:#66d9ef">for</span> label selector component<span style="color:#f92672">=</span>kube-apiserver
<span style="color:#f92672">[</span>upgrade/staticpods<span style="color:#f92672">]</span> Component <span style="color:#e6db74">&#34;kube-apiserver&#34;</span> upgraded successfully!
<span style="color:#f92672">[</span>upgrade/staticpods<span style="color:#f92672">]</span> Moved new manifest to <span style="color:#e6db74">&#34;/etc/kubernetes/manifests/kube-controller-manager.yaml&#34;</span> and backed up old manifest to <span style="color:#e6db74">&#34;/etc/kubernetes/tmp/kubeadm-backup-manifests-2018-09-30-00-46-56/kube-controller-manager.yaml&#34;</span>
<span style="color:#f92672">[</span>upgrade/staticpods<span style="color:#f92672">]</span> Waiting <span style="color:#66d9ef">for</span> the kubelet to restart the component
<span style="color:#f92672">[</span>upgrade/staticpods<span style="color:#f92672">]</span> This might take a minute or longer depending on the component/version gap <span style="color:#f92672">(</span>timeout 5m0s
Static pod: kube-controller-manager-master-pi hash: 22f67939f8b1abea8ba99666b78b5c93
Static pod: kube-controller-manager-master-pi hash: 980b4156606df8caafd0ad8abacc1485
<span style="color:#f92672">[</span>apiclient<span style="color:#f92672">]</span> Found <span style="color:#ae81ff">1</span> Pods <span style="color:#66d9ef">for</span> label selector component<span style="color:#f92672">=</span>kube-controller-manager
<span style="color:#f92672">[</span>upgrade/staticpods<span style="color:#f92672">]</span> Component <span style="color:#e6db74">&#34;kube-controller-manager&#34;</span> upgraded successfully!
<span style="color:#f92672">[</span>upgrade/staticpods<span style="color:#f92672">]</span> Moved new manifest to <span style="color:#e6db74">&#34;/etc/kubernetes/manifests/kube-scheduler.yaml&#34;</span> and backed up old manifest to <span style="color:#e6db74">&#34;/etc/kubernetes/tmp/kubeadm-backup-manifests-2018-09-30-00-46-56/kube-scheduler.yaml&#34;</span>
<span style="color:#f92672">[</span>upgrade/staticpods<span style="color:#f92672">]</span> Waiting <span style="color:#66d9ef">for</span> the kubelet to restart the component
<span style="color:#f92672">[</span>upgrade/staticpods<span style="color:#f92672">]</span> This might take a minute or longer depending on the component/version gap <span style="color:#f92672">(</span>timeout 5m0s
Static pod: kube-scheduler-master-pi hash: 0e545194d6b033abd681f02dfd11f4c8
Static pod: kube-scheduler-master-pi hash: 1b5ec5be325bf29f60be62789416a99e
<span style="color:#f92672">[</span>apiclient<span style="color:#f92672">]</span> Found <span style="color:#ae81ff">1</span> Pods <span style="color:#66d9ef">for</span> label selector component<span style="color:#f92672">=</span>kube-scheduler
<span style="color:#f92672">[</span>upgrade/staticpods<span style="color:#f92672">]</span> Component <span style="color:#e6db74">&#34;kube-scheduler&#34;</span> upgraded successfully!
<span style="color:#f92672">[</span>uploadconfig<span style="color:#f92672">]</span> storing the configuration used in ConfigMap <span style="color:#e6db74">&#34;kubeadm-config&#34;</span> in the <span style="color:#e6db74">&#34;kube-system&#34;</span> Namespace
<span style="color:#f92672">[</span>kubelet<span style="color:#f92672">]</span> Creating a ConfigMap <span style="color:#e6db74">&#34;kubelet-config-1.12&#34;</span> in namespace kube-system with the configuration <span style="color:#66d9ef">for</span> the kubelets in the cluster
<span style="color:#f92672">[</span>kubelet<span style="color:#f92672">]</span> Downloading configuration <span style="color:#66d9ef">for</span> the kubelet from the <span style="color:#e6db74">&#34;kubelet-config-1.12&#34;</span> ConfigMap in the kube-system namespace
<span style="color:#f92672">[</span>kubelet<span style="color:#f92672">]</span> Writing kubelet configuration to file <span style="color:#e6db74">&#34;/var/lib/kubelet/config.yaml&#34;</span>
<span style="color:#f92672">[</span>patchnode<span style="color:#f92672">]</span> Uploading the CRI Socket information <span style="color:#e6db74">&#34;/var/run/dockershim.sock&#34;</span> to the Node API object <span style="color:#e6db74">&#34;master-pi&#34;</span> as an annotation
<span style="color:#f92672">[</span>bootstraptoken<span style="color:#f92672">]</span> configured RBAC rules to allow Node Bootstrap tokens to post CSRs in order <span style="color:#66d9ef">for</span> nodes to get long term certificate credentials
<span style="color:#f92672">[</span>bootstraptoken<span style="color:#f92672">]</span> configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token
<span style="color:#f92672">[</span>bootstraptoken<span style="color:#f92672">]</span> configured RBAC rules to allow certificate rotation <span style="color:#66d9ef">for</span> all node client certificates in the cluster
<span style="color:#f92672">[</span>addons<span style="color:#f92672">]</span> Applied essential addon: CoreDNS
<span style="color:#f92672">[</span>addons<span style="color:#f92672">]</span> Applied essential addon: kube-proxy

<span style="color:#f92672">[</span>upgrade/successful<span style="color:#f92672">]</span> SUCCESS! Your cluster was upgraded to <span style="color:#e6db74">&#34;v1.12.0&#34;</span>. Enjoy!

<span style="color:#f92672">[</span>upgrade/kubelet<span style="color:#f92672">]</span> Now that your control plane is upgraded, please proceed with upgrading your kubelets <span style="color:#66d9ef">if</span> you haven<span style="color:#960050;background-color:#1e0010">&#39;</span>t already <span style="color:#66d9ef">done</span> so.
</code></pre></div><p>Kubernetes servers are running v1.12</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ kubectl version
Client Version: version.Info<span style="color:#f92672">{</span>Major:<span style="color:#e6db74">&#34;1&#34;</span>, Minor:<span style="color:#e6db74">&#34;11&#34;</span>, GitVersion:<span style="color:#e6db74">&#34;v1.11.1&#34;</span>, GitCommit:<span style="color:#e6db74">&#34;b1b29978270dc22fecc592ac55d903350454310a&#34;</span>, GitTreeState:<span style="color:#e6db74">&#34;clean&#34;</span>, BuildDate:<span style="color:#e6db74">&#34;2018-07-17T18:53:20Z&#34;</span>, GoVersion:<span style="color:#e6db74">&#34;go1.10.3&#34;</span>, Compiler:<span style="color:#e6db74">&#34;gc&#34;</span>, Platform:<span style="color:#e6db74">&#34;linux/arm&#34;</span><span style="color:#f92672">}</span>
Server Version: version.Info<span style="color:#f92672">{</span>Major:<span style="color:#e6db74">&#34;1&#34;</span>, Minor:<span style="color:#e6db74">&#34;12&#34;</span>, GitVersion:<span style="color:#e6db74">&#34;v1.12.0&#34;</span>, GitCommit:<span style="color:#e6db74">&#34;0ed33881dc4355495f623c6f22e7dd0b7632b7c0&#34;</span>, GitTreeState:<span style="color:#e6db74">&#34;clean&#34;</span>, BuildDate:<span style="color:#e6db74">&#34;2018-09-27T16:55:41Z&#34;</span>, GoVersion:<span style="color:#e6db74">&#34;go1.10.4&#34;</span>, Compiler:<span style="color:#e6db74">&#34;gc&#34;</span>, Platform:<span style="color:#e6db74">&#34;linux/arm&#34;</span><span style="color:#f92672">}</span>
</code></pre></div><p>my kubelets are still running kubernetes v1.11.1</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ kubectl get nodes
NAME        STATUS    ROLES     AGE       VERSION
home-pi     Ready     &lt;none&gt;    86d       v1.11.1
master-pi   Ready     master    86d       v1.11.1
nas-pi      Ready     &lt;none&gt;    85d       v1.11.1
</code></pre></div><h2 id="upgrade-kubectl">Upgrade kubectl</h2>
<p>Install newer version of kubectl using apt-get</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ sudo apt-get install kubectl
Reading package lists... Done
Building dependency tree
Reading state information... Done
The following packages will be upgraded:
  kubectl
<span style="color:#ae81ff">1</span> upgraded, <span style="color:#ae81ff">0</span> newly installed, <span style="color:#ae81ff">0</span> to remove and <span style="color:#ae81ff">37</span> not upgraded.
Need to get 8,639 kB of archives.
After this operation, 1,783 kB of additional disk space will be used.
Get:1 https://packages.cloud.google.com/apt kubernetes-xenial/main armhf kubectl armhf 1.12.0-00 <span style="color:#f92672">[</span>8,639 kB<span style="color:#f92672">]</span>
Fetched 8,639 kB in 6s <span style="color:#f92672">(</span>1,270 kB/s<span style="color:#f92672">)</span>
<span style="color:#f92672">(</span>Reading database ... <span style="color:#ae81ff">30574</span> files and directories currently installed.<span style="color:#f92672">)</span>
Preparing to unpack .../kubectl_1.12.0-00_armhf.deb ...
Unpacking kubectl <span style="color:#f92672">(</span>1.12.0-00<span style="color:#f92672">)</span> over <span style="color:#f92672">(</span>1.11.1-00<span style="color:#f92672">)</span> ...
Setting up kubectl <span style="color:#f92672">(</span>1.12.0-00<span style="color:#f92672">)</span> ...
</code></pre></div><p>Check that kubectl is now 1.12</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ kubectl version
Client Version: version.Info<span style="color:#f92672">{</span>Major:<span style="color:#e6db74">&#34;1&#34;</span>, Minor:<span style="color:#e6db74">&#34;12&#34;</span>, GitVersion:<span style="color:#e6db74">&#34;v1.12.0&#34;</span>, GitCommit:<span style="color:#e6db74">&#34;0ed33881dc4355495f623c6f22e7dd0b7632b7c0&#34;</span>, GitTreeState:<span style="color:#e6db74">&#34;clean&#34;</span>, BuildDate:<span style="color:#e6db74">&#34;2018-09-27T17:05:32Z&#34;</span>, GoVersion:<span style="color:#e6db74">&#34;go1.10.4&#34;</span>, Compiler:<span style="color:#e6db74">&#34;gc&#34;</span>, Platform:<span style="color:#e6db74">&#34;linux/arm&#34;</span><span style="color:#f92672">}</span>
Server Version: version.Info<span style="color:#f92672">{</span>Major:<span style="color:#e6db74">&#34;1&#34;</span>, Minor:<span style="color:#e6db74">&#34;12&#34;</span>, GitVersion:<span style="color:#e6db74">&#34;v1.12.0&#34;</span>, GitCommit:<span style="color:#e6db74">&#34;0ed33881dc4355495f623c6f22e7dd0b7632b7c0&#34;</span>, GitTreeState:<span style="color:#e6db74">&#34;clean&#34;</span>, BuildDate:<span style="color:#e6db74">&#34;2018-09-27T16:55:41Z&#34;</span>, GoVersion:<span style="color:#e6db74">&#34;go1.10.4&#34;</span>, Compiler:<span style="color:#e6db74">&#34;gc&#34;</span>, Platform:<span style="color:#e6db74">&#34;linux/arm&#34;</span><span style="color:#f92672">}</span>
</code></pre></div><h2 id="upgrade-kubelet-on-master-node">Upgrade kubelet on master node</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ sudo apt-get upgrade -y kubelet
Reading package lists... Done
Building dependency tree
Reading state information... Done
Calculating upgrade... Done
The following packages will be upgraded:
...
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ sudo systemctl restart kubelet
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ kubectl get nodes
NAME        STATUS   ROLES    AGE   VERSION
home-pi     Ready    &lt;none&gt;   86d   v1.11.1
master-pi   Ready    master   86d   v1.12.0
nas-pi      Ready    &lt;none&gt;   85d   v1.11.1
</code></pre></div><p>Looks that as useual something is wrong with flannel CNI</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ kubectl get all --all-namespaces
NAMESPACE     NAME                                             READY   STATUS    RESTARTS   AGE
default       pod/helm-rpi-kubeplay-arm32v7-6cb66496c6-6gvf6   1/1     Running   <span style="color:#ae81ff">0</span>          60d
kube-system   pod/coredns-576cbf47c7-nzhfj                     1/1     Running   <span style="color:#ae81ff">0</span>          37m
kube-system   pod/coredns-576cbf47c7-wkmhr                     1/1     Running   <span style="color:#ae81ff">0</span>          37m
kube-system   pod/etcd-master-pi                               1/1     Running   <span style="color:#ae81ff">0</span>          3m43s
kube-system   pod/kube-apiserver-master-pi                     1/1     Running   <span style="color:#ae81ff">2</span>          3m43s
kube-system   pod/kube-controller-manager-master-pi            1/1     Running   <span style="color:#ae81ff">1</span>          3m43s
kube-system   pod/kube-flannel-ds-4495g                        1/1     Running   <span style="color:#ae81ff">4</span>          75d
kube-system   pod/kube-flannel-ds-52ssk                        0/1     Error     <span style="color:#ae81ff">10</span>         75d
kube-system   pod/kube-flannel-ds-gj65n                        1/1     Running   <span style="color:#ae81ff">4</span>          75d

Investigation shows:

<span style="color:#e6db74">```</span>bash
$ kubectl logs pod/kube-flannel-ds-52ssk -n kube-system
I0930 01:34:13.768925       <span style="color:#ae81ff">1</span> main.go:475<span style="color:#f92672">]</span> Determining IP address of default interface
I0930 01:34:13.778622       <span style="color:#ae81ff">1</span> main.go:488<span style="color:#f92672">]</span> Using interface with name wlan0 and address 192.168.1.95
I0930 01:34:13.778716       <span style="color:#ae81ff">1</span> main.go:505<span style="color:#f92672">]</span> Defaulting external address to interface address <span style="color:#f92672">(</span>192.168.1.95<span style="color:#f92672">)</span>
I0930 01:34:14.168318       <span style="color:#ae81ff">1</span> kube.go:131<span style="color:#f92672">]</span> Waiting 10m0s <span style="color:#66d9ef">for</span> node controller to sync
I0930 01:34:14.168890       <span style="color:#ae81ff">1</span> kube.go:294<span style="color:#f92672">]</span> Starting kube subnet manager
I0930 01:34:15.169929       <span style="color:#ae81ff">1</span> kube.go:138<span style="color:#f92672">]</span> Node controller sync successful
I0930 01:34:15.170035       <span style="color:#ae81ff">1</span> main.go:235<span style="color:#f92672">]</span> Created subnet manager: Kubernetes Subnet Manager - master-pi
I0930 01:34:15.170064       <span style="color:#ae81ff">1</span> main.go:238<span style="color:#f92672">]</span> Installing signal handlers
I0930 01:34:15.170415       <span style="color:#ae81ff">1</span> main.go:353<span style="color:#f92672">]</span> Found network config - Backend type: vxlan
I0930 01:34:15.170797       <span style="color:#ae81ff">1</span> vxlan.go:120<span style="color:#f92672">]</span> VXLAN config: VNI<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> Port<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> GBP<span style="color:#f92672">=</span>false DirectRouting<span style="color:#f92672">=</span>false
E0930 01:34:15.256843       <span style="color:#ae81ff">1</span> main.go:280<span style="color:#f92672">]</span> Error registering network: failed to configure interface flannel.1: failed to ensure address of interface flannel.1: link has incompatible addresses. Remove additional addresses and try again. &amp;netlink.Vxlan<span style="color:#f92672">{</span>LinkAttrs:netlink.LinkAttrs<span style="color:#f92672">{</span>Index:5, MTU:1450, TxQLen:0, Name:<span style="color:#e6db74">&#34;flannel.1&#34;</span>, HardwareAddr:net.HardwareAddr<span style="color:#f92672">{</span>0x26, 0xd5, 0xd0, 0xdd, 0x56, 0x1a<span style="color:#f92672">}</span>,
...
</code></pre></div><p>Let&rsquo;s apply usual receipe
``bash
sudo ip link delete flannel.1</p>
<pre tabindex="0"><code>
Brute force fix seems to have done the fix....This is lucky we don't have production traffic on that node.
```bash
$ kubectl get pods -n kube-system
NAME                                    READY   STATUS    RESTARTS   AGE
coredns-576cbf47c7-nzhfj                1/1     Running   0          51m
coredns-576cbf47c7-wkmhr                1/1     Running   0          51m
etcd-master-pi                          1/1     Running   0          17m
kube-apiserver-master-pi                1/1     Running   2          17m
kube-controller-manager-master-pi       1/1     Running   1          17m
kube-flannel-ds-4495g                   1/1     Running   4          75d
kube-flannel-ds-52ssk                   1/1     Running   13         75d
kube-flannel-ds-gj65n                   1/1     Running   4          75d
kube-proxy-c2264                        1/1     Running   0          51m
kube-proxy-snjsg                        1/1     Running   0          49m
kube-proxy-zgqjb                        1/1     Running   1          50m
kube-scheduler-master-pi                1/1     Running   1          17m
kubernetes-dashboard-7d59788d44-rchkk   1/1     Running   25         83d
tiller-deploy-b59fcc885-dbvlv           1/1     Running   0          60d
</code></pre><h2 id="update-first-slave-node">Update first slave node</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo apt-get clean
sudo apt-get update
sudo apt-get install kubeadm
sudo apt-get install kubelet
sudo kubeadm upgrade node config --kubelet-version <span style="color:#66d9ef">$(</span>kubelet --version | cut -d <span style="color:#e6db74">&#39; &#39;</span> -f 2<span style="color:#66d9ef">)</span>
sudo systemctl restart kubelet
</code></pre></div><p>Same flannel issue</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ kubectl get pods -n kube-system
NAME                                    READY   STATUS             RESTARTS   AGE
coredns-576cbf47c7-nzhfj                1/1     Running            <span style="color:#ae81ff">0</span>          87m
coredns-576cbf47c7-wkmhr                1/1     Running            <span style="color:#ae81ff">1</span>          87m
etcd-master-pi                          1/1     Running            <span style="color:#ae81ff">0</span>          53m
kube-apiserver-master-pi                1/1     Running            <span style="color:#ae81ff">2</span>          53m
kube-controller-manager-master-pi       1/1     Running            <span style="color:#ae81ff">1</span>          53m
kube-flannel-ds-4495g                   0/1     CrashLoopBackOff   <span style="color:#ae81ff">10</span>         75d
...
</code></pre></div><p>same hack to fix the issue</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo ip link delete flannel.1
</code></pre></div><p>same hack seems to be effective</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ kubectl get pods -n kube-system
NAME                                    READY   STATUS    RESTARTS   AGE
coredns-576cbf47c7-nzhfj                1/1     Running   <span style="color:#ae81ff">0</span>          111m
coredns-576cbf47c7-wkmhr                1/1     Running   <span style="color:#ae81ff">1</span>          111m
etcd-master-pi                          1/1     Running   <span style="color:#ae81ff">0</span>          77m
kube-apiserver-master-pi                1/1     Running   <span style="color:#ae81ff">2</span>          77m
kube-controller-manager-master-pi       1/1     Running   <span style="color:#ae81ff">1</span>          77m
kube-flannel-ds-4495g                   1/1     Running   <span style="color:#ae81ff">11</span>         75d
...
</code></pre></div><h3 id="other-slave-node">Other slave node</h3>
<pre tabindex="0"><code>sudo apt-get clean
sudo apt-get update
sudo apt-get install kubeadm
sudo apt-get install kubelet
sudo kubeadm upgrade node config --kubelet-version $(kubelet --version | cut -d ' ' -f 2)
sudo systemctl restart kubelet
sudo ip link delete flannel.1
</code></pre><h2 id="check-consistency-of-the-cluster">Check consistency of the cluster</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ kubectl get pods -n kube-system
NAME                                    READY   STATUS    RESTARTS   AGE
coredns-576cbf47c7-nzhfj                1/1     Running   <span style="color:#ae81ff">1</span>          143m
coredns-576cbf47c7-wkmhr                1/1     Running   <span style="color:#ae81ff">1</span>          143m
etcd-master-pi                          1/1     Running   <span style="color:#ae81ff">0</span>          109m
kube-apiserver-master-pi                1/1     Running   <span style="color:#ae81ff">2</span>          109m
kube-controller-manager-master-pi       1/1     Running   <span style="color:#ae81ff">1</span>          109m
kube-flannel-ds-4495g                   1/1     Running   <span style="color:#ae81ff">11</span>         76d
kube-flannel-ds-52ssk                   1/1     Running   <span style="color:#ae81ff">13</span>         76d
kube-flannel-ds-gj65n                   1/1     Running   <span style="color:#ae81ff">13</span>         76d
kube-proxy-c2264                        1/1     Running   <span style="color:#ae81ff">1</span>          143m
kube-proxy-snjsg                        1/1     Running   <span style="color:#ae81ff">1</span>          141m
kube-proxy-zgqjb                        1/1     Running   <span style="color:#ae81ff">1</span>          142m
kube-scheduler-master-pi                1/1     Running   <span style="color:#ae81ff">1</span>          109m
kubernetes-dashboard-7d59788d44-rchkk   1/1     Running   <span style="color:#ae81ff">25</span>         83d
tiller-deploy-b59fcc885-dbvlv           1/1     Running   <span style="color:#ae81ff">0</span>          60d
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ kubectl get nodes
NAME        STATUS   ROLES    AGE   VERSION
home-pi     Ready    &lt;none&gt;   86d   v1.12.0
master-pi   Ready    master   86d   v1.12.0
nas-pi      Ready    &lt;none&gt;   86d   v1.12.0
</code></pre></div><h2 id="conclusion">Conclusion</h2>
<ul>
<li>At a glance, the cluster seems to be healthy</li>
<li>I still need to find sometool like sonobuoy to validate that the cluster is healthy</li>
</ul>
<h2 id="reference-links">Reference Links</h2>
<ul>
<li><a href="https://kubernetes.io/docs/tasks/administer-cluster/kubeadm/kubeadm-upgrade-1-12/">Official Upgrade documentation</a></li>
</ul>

  </div>

  <footer>
    <ul class="stats">
    
        

        
        
            <li>
                
                
                    

                    
                        Categories
                    
                
            </li>
        
    

    
    
        <li><a href='https://jbrette.github.io/categories/wiki'>wiki</a></li>
    
        <li><a href='https://jbrette.github.io/categories/kubedge'>kubedge</a></li>
    
        <li><a href='https://jbrette.github.io/categories/wip'>wip</a></li>
    
</ul>

  </footer>
</article>


    </div>
    
<section id="sidebar">

  
  <section id="intro">
    
    
      
        <a href='https://jbrette.github.io/'><img src="https://jbrette.github.io/images/logo.png" class="intro-circle" width="" alt="avatar" /></a>
      
    
    
      <header>
        <h2>Jerome&#39;s Blog</h2>
        <p>Building my edge cloud using Raspberry PI, keep learning from the opensource community</p>
      </header>
    
    
      <ul class="icons">
        
          
    <li><a href="https://jbrette.github.io/index.xml" type="application/rss+xml" target="_blank" title="RSS" class="fa fa-rss"></a></li>


        
        
  <li><a href="//github.com/jbrette" target="_blank" title="GitHub" class="fa fa-github"></a></li>

























  <li><a href="//linkedin.com/in/jerome-brette-109b8711" target="_blank" title="LinkedIn" class="fa fa-linkedin"></a></li>



































  <li><a href="//twitter.com/example" target="_blank" title="Twitter" class="fa fa-twitter"></a></li>




















      </ul>
    
  </section>

  
  <section class="recent-posts">
    <div class="mini-posts">
      <header>
        <h3>Recent Posts</h3>
      </header>
      <div class="posts-container">
        

        
          
        

        
          <article class="mini-post">
            <header>
              <h3>
                <a href="https://jbrette.github.io/post/">Post</a>
              </h3>
              
              <time class="published" datetime='2018-10-03'>
                October 3, 2018
              </time>
            </header>
            

          </article>
        
          <article class="mini-post">
            <header>
              <h3>
                <a href="https://jbrette.github.io/post/2018-10-03-a/">Prometheus</a>
              </h3>
              
              <time class="published" datetime='2018-10-03'>
                October 3, 2018
              </time>
            </header>
            
    

    
        
        







  
  
    
  


        
        
        

        <a href="https://jbrette.github.io/post/2018-10-03-a/" class="image featured">
            <img src="https://jbrette.github.io/date2018/10/load-node-stack1.png" alt="">
        </a>
    


          </article>
        
          <article class="mini-post">
            <header>
              <h3>
                <a href="https://jbrette.github.io/post/2018-09-28-a/">Rolling Upgrade</a>
              </h3>
              
              <time class="published" datetime='2018-09-28'>
                September 28, 2018
              </time>
            </header>
            
    

    
        
        







  
  
    
  


        
        
        

        <a href="https://jbrette.github.io/post/2018-09-28-a/" class="image featured">
            <img src="https://jbrette.github.io/img/2018/092018/09/rolling-upgrade.jpg" alt="">
        </a>
    


          </article>
        
      </div>

      
        <a href=
          
            /post/
          
        class="button">View more posts</a>
      
    </div>
  </section>

  
  
  
  
  
    <section id="categories">
      <header>
        <h3>
          <a href="https://jbrette.github.io/categories/">Categories</a>
        </h3>
      </header>
        
          
        

        
        <p>
          <article>
            <header>
              
                <a href="https://jbrette.github.io/categories/wiki/">wiki</a>
                <span style="float:right;">36</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="https://jbrette.github.io/categories/kubedge/">kubedge</a>
                <span style="float:right;">18</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="https://jbrette.github.io/categories/wip/">wip</a>
                <span style="float:right;">14</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="https://jbrette.github.io/categories/iot/">iot</a>
                <span style="float:right;">3</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="https://jbrette.github.io/categories/ai/">ai</a>
                <span style="float:right;">1</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="https://jbrette.github.io/categories/blockchain/">blockchain</a>
                <span style="float:right;">1</span>
              
            </header>
          </article>
        </p>
        
    </section>
  
  

  
  
    <section id="mini-bio">
      <h3>About</h3>
      <p>About the author</p>
      <a href="https://jbrette.github.io/about/" class="button">Learn More</a>
    </section>
  

  
  <section id="footer">
    
      <ul class="icons">
        
          
    <li><a href="https://jbrette.github.io/index.xml" type="application/rss+xml" target="_blank" title="RSS" class="fa fa-rss"></a></li>


        
        
  <li><a href="//github.com/jbrette" target="_blank" title="GitHub" class="fa fa-github"></a></li>

























  <li><a href="//linkedin.com/in/jerome-brette-109b8711" target="_blank" title="LinkedIn" class="fa fa-linkedin"></a></li>



































  <li><a href="//twitter.com/example" target="_blank" title="Twitter" class="fa fa-twitter"></a></li>




















      </ul>
    
    <p class="copyright">
      
        &copy; 2018
        
          Jerome Brette&#39;s Blog
        
      .
      Powered by <a href="//gohugo.io" target="_blank">Hugo</a>
    </p>
  </section>
</section>

    </div>
    <a id="back-to-top" href="#" class="fa fa-arrow-up fa-border fa-2x"></a>
    

    
      
    

    
      
      
      
        <script src="//cdn.bootcss.com/highlight.js/9.11.0/highlight.min.js"></script>
        
        
        
        <script src="//cdn.bootcss.com/highlight.js/9.11.0/languages/r.min.js"></script>
        <script src="//cdn.bootcss.com/highlight.js/9.11.0/languages/yaml.min.js"></script>
        <script src="//cdn.bootcss.com/highlight.js/9.11.0/languages/css.min.js"></script>
        <script src="//cdn.bootcss.com/highlight.js/9.11.0/languages/bash.min.js"></script>
        <script src="//cdn.bootcss.com/highlight.js/9.11.0/languages/python.min.js"></script>
        <script src="//cdn.bootcss.com/highlight.js/9.11.0/languages/golang.min.js"></script>
        <script>hljs.configure({languages: []}); hljs.initHighlightingOnLoad();</script>
      
    
    
    
      <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/skel/3.0.1/skel.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.1.25/jquery.fancybox.min.js"></script>
      <script src="https://jbrette.github.io/js/util.js"></script>
      <script src="https://jbrette.github.io/js/main.js"></script>
      <script src="https://jbrette.github.io/js/backToTop.js"></script>
    

    
      
        
      
    

    
    <script>hljs.initHighlightingOnLoad();</script>
      <script src="//yihui.name/js/math-code.js"></script>
<script async
src="//cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
</script>


  </body>
</html>

