<!DOCTYPE html>
<html lang="en-us">
<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Add Raspberry PI node to Kubernetes Cluster in 10 min - Jerome Brette&#39;s Blog</title>
<meta name="description" content="Add Raspberry PI node to Kubernetes Cluster in 10 min">
<meta name="generator" content="Hugo 0.92.2" />
<link href="https://jbrette.github.io//index.xml" rel="alternate" type="application/rss+xml">
<link rel="canonical" href="https://jbrette.github.io/kubernetes/rpi/2018-06-19-a/">
<link rel="stylesheet" href="https://jbrette.github.io/css/theme.min.css">
<link rel="stylesheet" href="https://jbrette.github.io/css/chroma.min.css">
<script defer src="https://jbrette.github.io//js/fontawesome6/all.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery.easing@1.4.1/jquery.easing.min.js" integrity="sha256-H3cjtrm/ztDeuhCN9I4yh4iN2Ybx/y1RM7rMmAesA0k=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js" integrity="sha256-4XodgW4TwIJuDtf+v6vDJ39FVxI0veC/kSCCmnFp7ck=" crossorigin="anonymous"></script>
<script src="https://jbrette.github.io/js/bundle.js"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123357787-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-123357787-1');
</script>
<style>
:root {}
</style>
<meta property="og:title" content="Add Raspberry PI node to Kubernetes Cluster in 10 min" />
<meta property="og:description" content="Add Raspberry PI node to Kubernetes Cluster in 10 min" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://jbrette.github.io/kubernetes/rpi/2018-06-19-a/" /><meta property="og:image" content="https://jbrette.github.io/images/og-image.png"/><meta property="article:section" content="kubernetes" />
<meta property="article:published_time" content="2018-06-19T00:00:00+00:00" />
<meta property="article:modified_time" content="2018-06-19T00:00:00+00:00" /><meta property="og:site_name" content="Hugo Techdoc Theme" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://jbrette.github.io/images/og-image.png"/>

<meta name="twitter:title" content="Add Raspberry PI node to Kubernetes Cluster in 10 min"/>
<meta name="twitter:description" content="Add Raspberry PI node to Kubernetes Cluster in 10 min"/>
<meta itemprop="name" content="Add Raspberry PI node to Kubernetes Cluster in 10 min">
<meta itemprop="description" content="Add Raspberry PI node to Kubernetes Cluster in 10 min"><meta itemprop="datePublished" content="2018-06-19T00:00:00+00:00" />
<meta itemprop="dateModified" content="2018-06-19T00:00:00+00:00" />
<meta itemprop="wordCount" content="353"><meta itemprop="image" content="https://jbrette.github.io/images/og-image.png"/>
<meta itemprop="keywords" content="kubedge,kubernetes,rpi," /></head>
<body><div class="container"><header>
<h1>Jerome Brette&#39;s Blog</h1>
<p class="description">Jerome Brette&#39;s Blog</p>

</header>
<div class="global-menu">
<nav>
<ul>
<li id="home" class=""><a href="/"><i class='fa fa-heart'></i>&nbsp;Home</a></li>
<li id="medium" class="twitter-menu-item"><a href="https://medium.com/@jbrette">Medium</a></li>
<li id="linkedin" class="twitter-menu-item"><a href="https://www.linkedin.com/in/jerome-brette-109b8711/">LinkedIn</a></li>
<li class=""><a href="/about/">About</a></li><li class="parent "><a href="">Tutorials<i class="fas fa-angle-right"></i></a>
<ul class="sub-menu">
<li class="child "><a href="/post/2018-09-26-a/">Blinkt</a></li>
</ul>
</li></ul>
</nav>
</div>

<div class="content-container">
<main><h1>Add Raspberry PI node to Kubernetes Cluster in 10 min</h1>
<h1 id="goal">Goal</h1>
<p>During some of the manipulation of the partition table of
my SD card, I ended up screwing up both my SD card and my backup Win32DiskImage backup.
Moreover if your SD card is 32G, it takes around 30 minute to restore from backup.
Hence the idea to come up with a way to build more resiliency in the cluster.
Recreating a node from scratch should not take more than 10 mn. The propose procedure
is still rather long because I did not push enough yet what the HypriotOS team, aka
build a default SD image where cloud-init does 100% of the initialization work.</p>
<h2 id="base-os">Base OS</h2>
<p>Flash HypriotOS to SD and reboot Pi.</p>
<pre tabindex="0"><code>Flash the SD Card with HypriotOS
Connect Pi through LAN (temporary).
Look for black-perl machine in DHCP
</code></pre><h2 id="connect-to-pi-through-lan">Connect to PI through LAN</h2>
<pre tabindex="0"><code>ssh 192.168.1.xxx -l rpiuser

ls -lt
docker ps
</code></pre><h2 id="enable-lan-or-wlan">Enable LAN or WLAN.</h2>
<p>Check the IP address. Depending on PI3B or PI3B+, the WLAN network may be different.</p>
<pre tabindex="0"><code>ip a
iwconfig
sudo ip link set wlan0 up
sudo iwlist scan | grep ES
sudo iwlist scan | grep ED
wpa_passphrase &lt;sommessid&gt;
sudo vi sudo vi /etc/network/interfaces.d/wlan0
sudo ifup wlan0
</code></pre><h2 id="freeze-your-configuration">Freeze your configuration</h2>
<p>Cloud init is perfect for the first boot. Once the node
is up, it can be challenging not to preserve the fine tuning done
to the OS.</p>
<pre tabindex="0"><code>sudo apt-get remove --purge cloud-init
sudo apt-get autoremove
</code></pre><h2 id="update-your-pi-name">Update your Pi name</h2>
<p>as root</p>
<pre tabindex="0"><code>sudo -i

vi /etc/hosts
vi /etc/hostname
</code></pre><p>I useally don&rsquo;t touch the file. Domain most likely
coming from your Internet router. I actually updated the settings
on the router to have consistent naming on my PI networks.</p>
<pre tabindex="0"><code>vi /etc/resolv.conf
</code></pre><h2 id="install-kubeadm">Install kubeadm</h2>
<p>Firt access the kubemaster node and regenerate a token:</p>
<pre tabindex="0"><code>kubeadm token create
</code></pre><p>Back on the new node, as root</p>
<pre tabindex="0"><code>curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | apt-key add -
echo &quot;deb http://apt.kubernetes.io/ kubernetes-xenial main&quot; &gt; /etc/apt/sources.list.d/kubernetes.list
apt-get update
apt-get install -y kubeadm
kubeadm join 192.168.1.95:6443 --token yyyyyy.xxxxxxxxxxxxxxxx --discovery-token-ca-cert-hash sha256:xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
</code></pre><h2 id="conclusion">Conclusion</h2>
<ul>
<li>Will have to come back later and use cloud-init, create a clean &amp; small SD image for Win32DiskImage</li>
<li>Will have to create more advanced partition on the SD card.</li>
</ul>
<div class="edit-meta">
Last updated on 19 Jun 2018


<br>
Published on 19 Jun 2018
<br><a href="https://github.com/jbrette/blog/edit/master/kubernetes/rpi/2018-06-19-a.md" class="edit-page"><i class="fas fa-pen-square"></i>&nbsp;Edit on GitHub</a></div><nav class="pagination"><a class="nav nav-prev" href="https://jbrette.github.io/kubernetes/rpi/2018-06-20-a/" title="Create a Rapsberry PI Rescue Dongle"><i class="fas fa-arrow-left" aria-hidden="true"></i>&nbsp;Prev - Create a Rapsberry PI Rescue Dongle</a>
<a class="nav nav-next" href="https://jbrette.github.io/kubernetes/sdk/" title="SDK">Next - SDK <i class="fas fa-arrow-right" aria-hidden="true"></i></a>
</nav><footer><p class="powered">Powered by <a href="https://gohugo.io">Hugo</a>. Theme by <a href="https://themes.gohugo.io/hugo-theme-techdoc/">TechDoc</a>. Designed by <a href="https://github.com/thingsym/hugo-theme-techdoc">Thingsym</a>.</p>
</footer>
</main>
<div class="sidebar">

<nav class="slide-menu">
<ul>
<li class=""><a href="https://jbrette.github.io/">Home</a></li>

<li class=" has-sub-menu"><a href="https://jbrette.github.io/ai_ml/">AI &amp; ML<span class="mark closed">+</span></a>
  
<ul class="sub-menu">
<li class=""><a href="https://jbrette.github.io/ai_ml/2018-07-19-a/">Kubeflow</a></li>
</ul>
  
</li>

<li class=" has-sub-menu"><a href="https://jbrette.github.io/iot/">IOT<span class="mark closed">+</span></a>
  
<ul class="sub-menu">
<li class=""><a href="https://jbrette.github.io/iot/2018-07-06-a/">ZWave/ZigBee</a></li>
<li class=""><a href="https://jbrette.github.io/iot/2018-07-05-a/">OpenHAB</a></li>
<li class=""><a href="https://jbrette.github.io/iot/2018-07-04-a/">HomeAssistant</a></li>
</ul>
  
</li>

<li class="parent has-sub-menu"><a href="https://jbrette.github.io/kubernetes/">Kubernetes<span class="mark opened">-</span></a>
  
<ul class="sub-menu">

<li class=""><a href="https://jbrette.github.io/kubernetes/operators/">Kubernetes Operators</a>
  
</li>

<li class=""><a href="https://jbrette.github.io/kubernetes/kustomize/">Kustomize</a>
  
</li>

<li class=" has-sub-menu"><a href="https://jbrette.github.io/kubernetes/devops/">DEVOPS<span class="mark closed">+</span></a>
  
<ul class="sub-menu">
<li class=""><a href="https://jbrette.github.io/kubernetes/devops/2018-07-11-a/">Use github repo as helm chart repository</a></li>
<li class=""><a href="https://jbrette.github.io/kubernetes/devops/2018-06-25-a/">Setup github/gerrit behind a corporate http proxy</a></li>
<li class=""><a href="https://jbrette.github.io/kubernetes/devops/2018-06-24-a/">docker.io versus docker-ce</a></li>
<li class=""><a href="https://jbrette.github.io/kubernetes/devops/2018-06-23-a/">Setup multiple GitHub account on a single machine</a></li>
<li class=""><a href="https://jbrette.github.io/kubernetes/devops/2018-06-22-a/">Setup your GOLANG environment</a></li>
</ul>
  
</li>

<li class="parent has-sub-menu"><a href="https://jbrette.github.io/kubernetes/rpi/">RASPBERRY PI<span class="mark opened">-</span></a>
  
<ul class="sub-menu">
<li class=""><a href="https://jbrette.github.io/kubernetes/rpi/2018-09-28-a/">Upgrade RPI Kubernetes cluster to 1.12</a></li>
<li class=""><a href="https://jbrette.github.io/kubernetes/rpi/2018-07-28-a/">Deploy Cassandra on Raspberry-PI 3</a></li>
<li class=""><a href="https://jbrette.github.io/kubernetes/rpi/2018-07-17-a/">Rebuild Calico for AMD64 ad ARM32V7</a></li>
<li class=""><a href="https://jbrette.github.io/kubernetes/rpi/2018-07-16-a/">Rebuild Hyperkube images</a></li>
<li class=""><a href="https://jbrette.github.io/kubernetes/rpi/2018-07-15-a/">Recompile Kubernetes components for Raspberry PI</a></li>
<li class=""><a href="https://jbrette.github.io/kubernetes/rpi/2018-07-14-a/">Deploy Flannel in Raspberry PI cluster</a></li>
<li class=""><a href="https://jbrette.github.io/kubernetes/rpi/2018-07-13-a/">Deploy Helm and Tiller on Rasberry PI Cluster</a></li>
<li class=""><a href="https://jbrette.github.io/kubernetes/rpi/2018-07-12-a/">Enable docker remote API</a></li>
<li class=""><a href="https://jbrette.github.io/kubernetes/rpi/2018-07-08-a/">Add Persistency Volume to PI Clusters</a></li>
<li class=""><a href="https://jbrette.github.io/kubernetes/rpi/2018-07-07-a/">Using Ansible to manage Raspberry PI cluster</a></li>
<li class=""><a href="https://jbrette.github.io/kubernetes/rpi/2018-07-03-a/">Creating a Raspberry 3 B&#43; Kubernetes Cluster</a></li>
<li class=""><a href="https://jbrette.github.io/kubernetes/rpi/2018-06-20-a/">Create a Rapsberry PI Rescue Dongle</a></li>
<li class="active"><a href="https://jbrette.github.io/kubernetes/rpi/2018-06-19-a/">Add Raspberry PI node to Kubernetes Cluster in 10 min</a></li>
</ul>
  
</li>

<li class=" has-sub-menu"><a href="https://jbrette.github.io/kubernetes/sdk/">SDK<span class="mark closed">+</span></a>
  
<ul class="sub-menu">
<li class=""><a href="https://jbrette.github.io/kubernetes/sdk/2018-06-30-a/">Update Kubernetes to 1.11 on Ubuntu</a></li>
<li class=""><a href="https://jbrette.github.io/kubernetes/sdk/2018-06-27-a/">Manual Update of CoreOS</a></li>
<li class=""><a href="https://jbrette.github.io/kubernetes/sdk/2018-06-21-a/">Setup SingleNode Kubernetes Cluster using kubeadm</a></li>
</ul>
  
</li>

<li class=" has-sub-menu"><a href="https://jbrette.github.io/kubernetes/apps/">APPS<span class="mark closed">+</span></a>
  
<ul class="sub-menu">
<li class=""><a href="https://jbrette.github.io/kubernetes/apps/2018-07-01-a/">Creating simple Python server container</a></li>
<li class=""><a href="https://jbrette.github.io/kubernetes/apps/2018-06-29-a/">Creating simple GO server container</a></li>
<li class=""><a href="https://jbrette.github.io/kubernetes/apps/2018-06-28-a/">Creating simple Java 10 server container</a></li>
</ul>
  
</li>

<li class=" has-sub-menu"><a href="https://jbrette.github.io/kubernetes/misc/">MISC<span class="mark closed">+</span></a>
  
<ul class="sub-menu">
<li class=""><a href="https://jbrette.github.io/kubernetes/misc/2018-08-01-a/">Build and Deploy Kubernetes Hashicorp Vault</a></li>
<li class=""><a href="https://jbrette.github.io/kubernetes/misc/2018-07-31-a/">Build and Deploy Kubernetes Istio</a></li>
<li class=""><a href="https://jbrette.github.io/kubernetes/misc/2018-07-30-a/">Build and Deploy Kubernetes test-infra</a></li>
<li class=""><a href="https://jbrette.github.io/kubernetes/misc/2018-07-29-a/">Build and Deploy Kubernetes Kustomize</a></li>
<li class=""><a href="https://jbrette.github.io/kubernetes/misc/2018-07-18-a/">Compile and Test Portieris</a></li>
<li class=""><a href="https://jbrette.github.io/kubernetes/misc/2018-07-02-a/">Compile and Test SONOBUOY</a></li>
<li class=""><a href="https://jbrette.github.io/kubernetes/misc/2018-06-26-a/">Zuul</a></li>
</ul>
  
</li>
</ul>
  
</li>










</ul>
</nav>



<div class="sidebar-footer"></div>
</div>

</div><a href="#" id="backtothetop-fixed" class="backtothetop"
 data-backtothetop-duration="600"
 data-backtothetop-easing="easeOutQuart"
 data-backtothetop-fixed-fadeIn="1000"
 data-backtothetop-fixed-fadeOut="1000"
 data-backtothetop-fixed-bottom="10"
 data-backtothetop-fixed-right="20">
<span class="fa-layers fa-fw">
<i class="fas fa-circle"></i>
<i class="fas fa-arrow-circle-up"></i>
</span></a>
</div>
</body>
</html>
